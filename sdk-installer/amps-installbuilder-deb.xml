<project>
    <shortName>atlassianpluginsdk</shortName>
    <fullName>Atlassian Plugin SDK</fullName>
    <version>1.0</version>
    <installerFilename>atlassian-plugin-sdk-${project.version}-${platform_name}.${platform_exec_suffix}</installerFilename>
    <leftImage>sidebar-sdk-installer.png</leftImage>
    <logoImage>sdk-logo.png</logoImage>
    <splashImage>sdk-splash-screen.png</splashImage>
    <wmImage>sdk-logo.png</wmImage>
    <defaultLanguage>auto</defaultLanguage>
    <allowLanguageSelection>1</allowLanguageSelection>
    <componentList>
        <component>
            <name>default</name>
            <description>Default Component</description>
            <canBeEdited>1</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Install Dir</description>
                    <destination>/usr/share/atlassian-plugin-sdk-${project.version}</destination>
                    <name>installdir</name>
                    <platforms>all</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <allowWildcards>1</allowWildcards>
                            <origin>${sdkUnzipDir}</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
            </folderList>
        </component>
    </componentList>
    <postInstallationActionList>
        <setInstallerVariable>
            <name>hasJavaHome</name>
            <value>true</value>
            <ruleList>
                <compareText>
                    <logic>does_not_equal</logic>
                    <text>$env(JAVA_HOME)}</text>
                    <value></value>
                </compareText>
            </ruleList>
        </setInstallerVariable>

	<!-- handle already defined JAVA_HOME -->
	<actionGroup>
            <actionList>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>${env(JAVA_HOME)}${platform_path_separator}bin${platform_path_separator}java</program>
                    <programArguments>-version</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                </runProgram>
                <setInstallerVariableFromRegEx>
                    <name>javaVersion</name>
                    <pattern>^java version \"?([^\"\n]+)\"?.*$</pattern>
                    <substitution>\1</substitution>
                    <text>${program_stderr}</text>
                </setInstallerVariableFromRegEx>
                <setInstallerVariable>
                    <name>hasJava16Home</name>
                    <value>true</value>
                    <ruleList>
                        <compareVersions>
                            <logic>greater_or_equal</logic>
                            <version1>${javaVersion}</version1>
                            <version2>1.6</version2>
                        </compareVersions>
                    </ruleList>
                </setInstallerVariable>
                <addDirectoryToPath>
                    <insertAt>end</insertAt>
                    <path>${'${JAVA_HOME}'}/bin</path>
                    <scope>user</scope>
                    <ruleList>
                        <isTrue>
                            <value>${hasJava16Home}</value>
                        </isTrue>
                        <programTest>
                            <condition>is_not_in_path</condition>
                            <name>java</name>
                        </programTest>
                    </ruleList>
                </addDirectoryToPath>
            </actionList>
            <ruleList>
                <isTrue>
                    <value>${hasJavaHome}</value>
                </isTrue>
            </ruleList>
        </actionGroup>

	<!-- didn't find java 1.6+, we need to detect it -->
	<actionGroup>
            <actionList>
                <autodetectJava>
                    <abortOnError>0</abortOnError>
                    <promptUser>0</promptUser>
                    <selectionOrder>newest</selectionOrder>
                    <showMessageOnError>0</showMessageOnError>
                    <validVersionList>
                        <validVersion>
                            <bitness></bitness>
                            <maxVersion></maxVersion>
                            <minVersion>1.6</minVersion>
                            <requireJDK>1</requireJDK>
                            <vendor>sun</vendor>
                        </validVersion>
                    </validVersionList>
                </autodetectJava>
                <actionGroup>
                    <actionList>
                        <setInstallerVariableFromRegEx>
                            <name>java16Home</name>
                            <pattern>(^.*)/[^/]+/[^/]+$</pattern>
                            <substitution>\1</substitution>
                            <text>${java_executable}</text>
                        </setInstallerVariableFromRegEx>
                        <addEnvironmentVariable>
                            <name>JAVA_HOME</name>
                            <scope>user</scope>
                            <value>${java16Home}</value>
                        </addEnvironmentVariable>
                        <addDirectoryToPath>
                            <insertAt>end</insertAt>
                            <path>${'${JAVA_HOME}'}/bin</path>
                            <scope>user</scope>
                            <ruleList>
                                <programTest>
                                    <condition>is_not_in_path</condition>
                                    <name>java</name>
                                </programTest>
                            </ruleList>
                        </addDirectoryToPath>
                    </actionList>
                    <ruleList>
                        <isTrue>
                            <value>${java_autodetected}</value>
                        </isTrue>
                    </ruleList>
                </actionGroup>
            </actionList>
            <ruleList>
                <isFalse>
                    <value>${hasJava16Home}</value>
                </isFalse>
            </ruleList>
        </actionGroup>
        <addEnvironmentVariable>
            <name>ATLASSIAN_PLUGIN_SDK</name>
            <scope>user</scope>
            <value>${installdir}</value>
        </addEnvironmentVariable>
        <addDirectoryToPath>
            <insertAt>end</insertAt>
            <path>${'${ATLASSIAN_PLUGIN_SDK}'}/bin</path>
            <scope>user</scope>
            <ruleList>
                <programTest>
                    <condition>is_not_in_path</condition>
                    <name>atlas-version</name>
                </programTest>
            </ruleList>
        </addDirectoryToPath>
    </postInstallationActionList>
    <cdromDirectory>${product_version}-cdrom</cdromDirectory>
    <compressionAlgorithm>lzma</compressionAlgorithm>
    <description>Development kit to build Atlassian plugins</description>
    <enableDebugger>1</enableDebugger>
    <enableRollback>0</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <nativePackageName>atlassian-plugin-sdk</nativePackageName>
    <osxApplicationBundleIcon>sdk-mac-icon.icns</osxApplicationBundleIcon>
    <osxUninstallerApplicationBundleIcon>sdk-mac-icon.icns</osxUninstallerApplicationBundleIcon>
    <rebootRequired>1</rebootRequired>
    <saveRelativePaths>1</saveRelativePaths>
    <summary>Development kit to build Atlassian plugins</summary>
    <unattendedModeUI>minimal</unattendedModeUI>
    <vendor>Atlassian</vendor>
    <windowsExecutableIcon>sdk-win-icon.ico</windowsExecutableIcon>
    <windowsUninstallerExecutableIcon>sdk-win-icon.ico</windowsUninstallerExecutableIcon>
    <customLanguageFileList>
        <language>
            <code>en</code>
            <encoding>utf-8</encoding>
            <file>messages/messages_en.utf8</file>
        </language>
    </customLanguageFileList>
</project>

